// Solution for https://adventofcode.com/2021/day/3 (Ctrl+Click in VS to follow link)

// Your input:
// The diagnostic report (your puzzle input) consists of a list of binary numbers which,
// when decoded properly, can tell you many useful things about the conditions of the submarine.
// The first parameter to check is the power consumption.

string testInput = "00100\r\n11110\r\n10110\r\n10111\r\n10101\r\n01111\r\n00111\r\n11100\r\n10000\r\n11001\r\n00010\r\n01010";
string myInput = "110001010110\r\n011101111101\r\n111011110101\r\n011110101000\r\n100100011001\r\n011001001110\r\n101011000101\r\n110000111111\r\n110110101000\r\n010101101000\r\n001101001101\r\n111000001011\r\n111000011010\r\n001111001000\r\n100110001111\r\n111100110100\r\n100000010101\r\n001110100000\r\n100111110110\r\n100110000110\r\n111100101101\r\n100101010100\r\n011100010011\r\n111010110000\r\n110100011110\r\n111010101100\r\n111001001101\r\n110001110100\r\n100110111011\r\n101111111011\r\n011100111000\r\n010011110010\r\n111001011011\r\n110100111000\r\n111000011001\r\n010100000000\r\n100000101111\r\n010100110010\r\n110001101000\r\n000101101001\r\n001111101010\r\n100100000001\r\n101000111011\r\n101110001111\r\n000100011000\r\n100110101110\r\n111011101010\r\n010110001101\r\n110100001111\r\n011110101100\r\n101000011100\r\n111101111101\r\n110101010100\r\n101100111111\r\n111110110101\r\n011011110111\r\n101101000111\r\n111101000011\r\n001011110110\r\n110011110111\r\n000011101111\r\n100001101010\r\n111011101101\r\n010110111000\r\n110101111100\r\n110010101000\r\n001011001010\r\n000110101001\r\n000001000011\r\n111100001010\r\n100110111010\r\n111011111000\r\n011111101111\r\n000010100111\r\n111011011111\r\n011101110010\r\n000000100111\r\n100111000100\r\n000010010111\r\n101111101011\r\n011111000101\r\n011100100101\r\n011000111101\r\n011110001010\r\n100110101011\r\n011011010011\r\n011100000101\r\n011110000100\r\n000110110010\r\n001101101110\r\n110011000001\r\n110100111110\r\n110011000101\r\n000101011110\r\n001010000000\r\n000011000010\r\n110010111110\r\n011111110110\r\n100000110000\r\n011101111000\r\n100011100101\r\n101000000101\r\n001111010011\r\n010110110011\r\n000100100100\r\n001010001001\r\n010011100100\r\n110101110011\r\n001001000001\r\n101110110010\r\n001001000110\r\n010010100000\r\n000111101011\r\n010010001000\r\n011111000111\r\n010011010001\r\n110101101101\r\n000110010101\r\n111011110100\r\n010000110101\r\n110110101111\r\n010110111101\r\n100000010000\r\n001010011111\r\n111001001111\r\n011110110111\r\n101011000111\r\n010100011110\r\n111100100011\r\n110100110110\r\n001000011000\r\n011011111101\r\n111111110010\r\n000011110010\r\n110101111101\r\n001011111101\r\n000010011000\r\n001111101101\r\n100010010101\r\n111101110001\r\n011010110101\r\n011000000110\r\n111110100011\r\n000010111001\r\n101001111100\r\n001011011010\r\n100110111110\r\n000111001010\r\n001011101110\r\n100010110110\r\n001100110000\r\n000110001010\r\n100010001000\r\n111110011110\r\n110011111000\r\n100011101110\r\n001110100101\r\n010110110000\r\n101110101010\r\n110111010111\r\n110011000100\r\n100110101100\r\n101110100110\r\n010101011101\r\n100111100010\r\n010110110010\r\n000111100001\r\n101001101001\r\n011101110101\r\n011111100111\r\n000101010011\r\n110111100010\r\n011110000000\r\n011101110110\r\n110100110100\r\n111110111001\r\n000100000011\r\n011110111011\r\n011010100111\r\n111100110111\r\n100010011101\r\n011001001111\r\n001010101100\r\n010110111010\r\n111000110010\r\n011011100111\r\n101111000010\r\n110011011100\r\n110110011110\r\n000101011100\r\n100100110000\r\n110000100011\r\n011001101001\r\n110000100010\r\n001000000011\r\n010110001100\r\n111111000001\r\n101111011100\r\n100100100101\r\n101010100110\r\n011110000001\r\n010100110110\r\n010111011000\r\n011110100010\r\n101000110010\r\n110001011011\r\n111110011111\r\n111100100110\r\n111110101000\r\n010001111101\r\n111000101111\r\n111001010110\r\n101000001111\r\n000100101001\r\n011101011001\r\n111101111100\r\n010001100100\r\n010111011100\r\n100101010110\r\n001010110010\r\n010010111110\r\n101110011100\r\n111100101010\r\n001001111111\r\n011101010000\r\n111011111101\r\n011000001110\r\n111100110010\r\n001001111101\r\n011100001110\r\n001001001000\r\n110011101111\r\n010001011110\r\n001100100100\r\n011100110000\r\n111100001110\r\n111110110000\r\n000011000011\r\n011000000011\r\n110010111111\r\n011110001011\r\n101110100010\r\n100100111000\r\n111101011010\r\n000111110101\r\n010100001001\r\n110010101101\r\n001101011111\r\n000101100101\r\n110011101100\r\n110111111111\r\n111000011000\r\n010000100100\r\n110101101011\r\n101010101001\r\n100111001101\r\n111011000001\r\n101101111010\r\n111001111001\r\n001001110100\r\n000111110000\r\n010111010110\r\n100011010111\r\n111011011101\r\n100010100001\r\n000111001110\r\n111100010001\r\n101001101101\r\n111101100111\r\n100110100010\r\n000010100101\r\n010010110111\r\n101100000101\r\n111011010110\r\n101101101101\r\n001110110111\r\n110011011111\r\n011111111001\r\n100100001100\r\n101010011101\r\n100000110110\r\n110101010000\r\n110110110111\r\n101001110110\r\n100001000101\r\n110100001001\r\n000111000100\r\n101000101001\r\n111111001100\r\n101011000100\r\n111000010100\r\n100111000110\r\n111011010100\r\n101101011101\r\n010000101101\r\n000110110110\r\n001110000101\r\n001010001000\r\n100111101111\r\n001011101001\r\n001100111101\r\n110111011111\r\n111010011010\r\n001110101111\r\n101000001110\r\n101001110001\r\n110111010010\r\n011111100101\r\n110001001001\r\n010010111010\r\n000001001010\r\n011000001100\r\n100000111011\r\n111000010101\r\n001110011001\r\n010001001100\r\n001100010101\r\n001011011000\r\n001101100100\r\n011001111111\r\n010010001011\r\n100010011111\r\n100011000100\r\n000110011110\r\n010010000000\r\n110110011001\r\n111000111010\r\n111010000111\r\n111011110110\r\n101101100111\r\n111100101001\r\n110001101110\r\n111101100001\r\n011111110111\r\n110110101001\r\n000111010101\r\n101011111111\r\n100110001000\r\n101000100000\r\n110101110010\r\n010100011011\r\n000000100101\r\n000000011110\r\n101011110000\r\n101001100001\r\n111010101101\r\n000011011100\r\n000000100010\r\n001011100000\r\n001110111111\r\n110100111001\r\n010110110111\r\n010111111010\r\n110100011010\r\n000101011111\r\n001000011100\r\n010011001011\r\n111011001100\r\n101111001101\r\n100010000001\r\n011000001010\r\n101010000011\r\n110110010100\r\n101001011101\r\n100001010001\r\n110011010101\r\n000001100000\r\n100101000101\r\n110110100110\r\n110001111010\r\n111011101011\r\n010010111101\r\n000110100101\r\n011110101110\r\n000101110001\r\n111111101100\r\n011100110010\r\n100011111010\r\n010011111101\r\n101000010101\r\n011000101000\r\n011111001111\r\n111001111010\r\n100000000100\r\n010000101001\r\n110000001000\r\n100100001101\r\n011001111010\r\n110111110111\r\n000011100111\r\n001100110001\r\n000111010001\r\n101110011110\r\n110010000010\r\n101100001101\r\n001000001100\r\n101110011001\r\n111000000110\r\n000111111100\r\n001110001110\r\n100011110100\r\n001011101100\r\n011010010010\r\n101000011111\r\n110001011010\r\n011001000000\r\n010011110001\r\n100001111011\r\n011011001111\r\n110100010011\r\n010111010001\r\n010101011011\r\n100000001100\r\n100111101010\r\n100010100000\r\n110000110001\r\n010000010101\r\n010101000010\r\n010100101100\r\n110101000001\r\n100010010110\r\n110011101011\r\n010101011001\r\n010001000011\r\n000011111110\r\n111110011101\r\n011010010000\r\n011011111100\r\n110010110011\r\n001101111011\r\n000011111101\r\n110000010110\r\n111011011011\r\n111110000000\r\n101100111010\r\n100110011111\r\n110111011001\r\n110110010010\r\n010010011110\r\n010110010101\r\n101110000000\r\n011001110110\r\n100110100011\r\n111101111010\r\n110101010011\r\n111110100010\r\n100110001100\r\n010010100010\r\n101010100001\r\n000000000101\r\n111001011100\r\n100100111110\r\n000000011010\r\n110011111101\r\n010100000011\r\n100001111111\r\n110001011001\r\n111111100011\r\n111101110000\r\n100011001101\r\n110001010100\r\n100110000111\r\n111110110110\r\n001011000011\r\n111111000000\r\n101011101101\r\n110001111011\r\n011111001000\r\n000001011101\r\n001101000011\r\n001000010000\r\n000011001110\r\n011001101000\r\n110101100101\r\n001111110111\r\n111110111101\r\n000011000111\r\n001010011100\r\n110010010011\r\n110001110111\r\n111010010011\r\n100010001110\r\n110000101000\r\n011001011000\r\n011100100000\r\n001000011001\r\n101011110011\r\n001010011110\r\n110100000101\r\n010011011110\r\n011001100001\r\n011110011010\r\n100110000000\r\n010110010100\r\n000100111110\r\n110101110101\r\n000110111100\r\n010000000111\r\n111101010100\r\n111011011100\r\n000010000011\r\n001100100001\r\n110010110001\r\n010010000010\r\n001000010110\r\n011001000001\r\n010100101110\r\n011100010100\r\n100000011010\r\n010111100000\r\n010111011001\r\n011100101001\r\n101110101011\r\n110010011001\r\n111110001110\r\n011100011100\r\n110000101010\r\n000010100010\r\n100101101110\r\n100010111010\r\n110101100001\r\n101111000100\r\n101000111001\r\n011111101101\r\n111100111110\r\n011001001000\r\n110100110010\r\n000011010101\r\n111010111011\r\n010010011000\r\n100101000100\r\n111010100100\r\n000111001101\r\n010001011000\r\n111101101100\r\n111110001111\r\n110100011011\r\n111100010101\r\n111001111100\r\n011100111011\r\n011011101111\r\n011001000011\r\n011100111101\r\n010100100010\r\n110101010110\r\n101100001000\r\n001100101001\r\n000001001111\r\n000110010100\r\n111101101010\r\n100111000111\r\n001011000111\r\n001011111011\r\n110101011100\r\n110000110101\r\n010001000110\r\n011100101111\r\n101110010001\r\n001011001000\r\n100100110010\r\n000011111000\r\n010010010000\r\n001011100010\r\n000000110011\r\n000101011010\r\n101111110000\r\n100001010100\r\n101110110110\r\n001100000101\r\n110111001101\r\n010001010011\r\n101011001111\r\n111111111110\r\n110011010011\r\n011101000101\r\n100001101000\r\n011001101100\r\n011100010000\r\n001111111000\r\n010110011111\r\n111101110100\r\n100011011101\r\n100010110011\r\n110111011000\r\n100110010101\r\n001001000000\r\n101000100110\r\n011010011010\r\n000000000110\r\n010011001010\r\n110000110010\r\n100001011010\r\n101111001001\r\n100010101001\r\n110111111100\r\n000010111110\r\n000110101111\r\n011101001011\r\n101110011010\r\n111101010101\r\n001101100110\r\n111100001101\r\n000011100000\r\n100111010110\r\n110100100111\r\n100011100110\r\n100001011110\r\n001110110011\r\n101011010011\r\n001100001000\r\n111011001110\r\n110011100000\r\n101000011001\r\n011100100001\r\n000110001011\r\n001001001001\r\n000011011101\r\n000010111010\r\n011001100111\r\n101001011011\r\n010001101101\r\n101110001011\r\n000001011110\r\n011100110001\r\n110011111011\r\n001101010011\r\n000101000110\r\n110101000000\r\n110000101111\r\n000110110111\r\n110100101100\r\n111011110000\r\n011110011101\r\n001101000001\r\n011010001010\r\n101000111010\r\n111101111000\r\n000010000000\r\n000010001010\r\n110000100110\r\n110010100111\r\n110000001100\r\n100010000100\r\n110010100101\r\n111011101001\r\n100011110000\r\n010110110110\r\n111100011011\r\n110001101111\r\n110010101111\r\n001001001010\r\n100100000011\r\n110100100011\r\n101010110001\r\n001001011111\r\n101101110110\r\n001111010101\r\n110000010011\r\n010110001110\r\n011011011100\r\n000000110100\r\n100101110001\r\n011011001100\r\n100101000001\r\n100101101101\r\n101010001110\r\n110101100110\r\n111010111101\r\n111001000101\r\n010101111100\r\n000110000000\r\n001010111010\r\n110110000001\r\n100000101110\r\n111011110010\r\n000111000101\r\n011001110010\r\n000100101010\r\n101001010010\r\n010001100001\r\n000101100000\r\n111000101110\r\n000100010010\r\n110110000011\r\n010101001010\r\n110101101110\r\n101111101000\r\n110011100101\r\n111110110011\r\n000100010011\r\n110110010001\r\n111100000010\r\n011011111011\r\n101101101001\r\n101011011001\r\n011011011111\r\n101100110001\r\n011011100010\r\n011101010101\r\n011101110100\r\n010000101011\r\n010110011011\r\n111001101001\r\n010010010010\r\n010111000010\r\n100001101100\r\n000000101110\r\n000000110101\r\n111001000100\r\n110111001110\r\n111100111001\r\n110101010010\r\n111100011000\r\n100110100100\r\n000100000000\r\n110111101011\r\n001011110111\r\n010101101011\r\n101110001100\r\n111111101010\r\n111100010110\r\n101000110011\r\n110100010000\r\n010010001100\r\n011101111100\r\n000011110001\r\n011010101010\r\n110001101010\r\n101001000011\r\n100010000110\r\n110100111101\r\n000011110110\r\n001010100110\r\n010111010101\r\n101011100111\r\n000101001000\r\n110010001000\r\n001100000100\r\n010000111100\r\n111011111111\r\n100101001010\r\n110011100111\r\n100011100000\r\n101010011111\r\n010111100101\r\n110110110101\r\n010111010000\r\n110011001110\r\n101100111101\r\n000001100001\r\n111010100001\r\n010000010110\r\n001001000101\r\n101011110001\r\n000101101110\r\n011110000010\r\n110011110100\r\n100001000001\r\n100000011110\r\n001101100101\r\n101111101101\r\n110010010100\r\n010111101110\r\n010101110111\r\n101010101000\r\n000100000010\r\n111000001010\r\n101100001100\r\n101010000001\r\n101001101011\r\n110110000000\r\n101100101101\r\n101010110011\r\n011000001001\r\n101010111010\r\n000001001100\r\n101001000010\r\n110000001111\r\n110101001101\r\n110011111111\r\n010110101111\r\n001101110110\r\n111010001010\r\n001010100010\r\n000101101011\r\n001100010111\r\n101111100111\r\n010100000101\r\n110111110000\r\n000110111011\r\n110000011000\r\n100101010000\r\n101010111100\r\n100101000111\r\n001110100111\r\n001000111011\r\n011010010100\r\n111110010010\r\n010101010000\r\n101100010110\r\n000011001100\r\n010010101011\r\n011011000100\r\n011100111100\r\n111010111010\r\n101111010000\r\n101011010000\r\n001010100111\r\n010100111100\r\n011001000010\r\n011110110100\r\n111000001001\r\n110010110010\r\n101011111001\r\n110001111001\r\n101001000100\r\n010100100011\r\n000110110101\r\n001000100010\r\n100110110010\r\n000100010001\r\n010100010010\r\n001011000000\r\n110101011000\r\n001001101011\r\n000111101110\r\n000100110000\r\n010000010100\r\n001011011011\r\n100000001110\r\n111010110100\r\n111001101011\r\n101110110011\r\n111010111111\r\n010101010100\r\n001110111110\r\n111010110110\r\n001101001011\r\n010111101011\r\n000110100011\r\n100001010000\r\n011111001010\r\n011001001001\r\n101100001001\r\n001100111011\r\n001001110111\r\n101110110000\r\n010011010100\r\n001100001111\r\n001111100001\r\n010100010011\r\n001001000010\r\n100101001100\r\n001010001101\r\n011011001001\r\n101110110001\r\n010001110100\r\n101101011001\r\n010001111001\r\n011101001000\r\n010011100011\r\n001000111010\r\n111110100101\r\n110000010001\r\n110100000000\r\n101011101110\r\n011101001111\r\n111110001101\r\n101100010000\r\n010100010101\r\n000010001000\r\n111111010110\r\n000100010100\r\n110100010101\r\n110010000110\r\n001111010111\r\n000100101100\r\n001111100111\r\n011110001101\r\n000111001111\r\n000001000110\r\n101100100000\r\n110100010100\r\n001011010000\r\n101011100110\r\n010000101010\r\n101001000101\r\n011000010110\r\n010111110100\r\n110010001001\r\n001111010000\r\n010010100111\r\n011001010001\r\n100010100010\r\n011111010101\r\n011100000010\r\n110101110000\r\n001010110100\r\n101110111110\r\n000010110100\r\n101100000100\r\n111010110111\r\n001001101010\r\n111010010110\r\n011011001010\r\n100001010111\r\n110010011101\r\n010110100001\r\n110000111101\r\n011001110111\r\n111110001010\r\n000101101010\r\n010011101101\r\n110111010001\r\n111011011010\r\n001111111010\r\n100111001111\r\n010111111111\r\n010000010000\r\n001111110011\r\n100110100000\r\n000100101111\r\n001000010010\r\n110001010001\r\n001011100111\r\n101111111111\r\n100101101001\r\n000010011001\r\n011011001101\r\n010110100000\r\n101001101100\r\n010010001111\r\n110111001001\r\n101011001000\r\n001001010010\r\n011011001000\r\n001110010110\r\n011011101011\r\n100111111101\r\n110001001111\r\n001110101001\r\n101101111011\r\n101011011101\r\n100100011111\r\n100001001111\r\n101000001010\r\n000010011010\r\n010110010010\r\n100101110100\r\n010100010100\r\n110111001111\r\n100000101001\r\n010110101100\r\n011101010011\r\n000111000011\r\n000000101010\r\n101001110010\r\n010101001000\r\n111100000001\r\n100101000010\r\n010011011010\r\n011111110011\r\n011111010011\r\n110001000101\r\n100010101011\r\n111010011101\r\n010110010110\r\n110011101000\r\n101001000000\r\n000000011100\r\n010011100000\r\n101010111000\r\n000101110101\r\n100111111110\r\n010100100110\r\n110110110100\r\n110001001011\r\n100010111101\r\n111111111101\r\n111111110101\r\n000110100110\r\n001100110011\r\n000011100101\r\n111000110011\r\n111010100010\r\n101010011001\r\n001110011010\r\n010100000100\r\n010010000011\r\n101000000001\r\n000011110000\r\n010011011100\r\n111000110001\r\n010111101111\r\n101100010010\r\n101110111111\r\n111101100101\r\n001100101011\r\n100110111100\r\n011100011010\r\n";

List<string> numbersAsString = myInput.Split("\r\n", StringSplitOptions.RemoveEmptyEntries).ToList();

// With these numbers, for every bit position, find the most common bit (1 or 0) and use that
// to construct a new number called gamma. With gamma, construct the opposite called epsilon.
// Multiply them to find the answer.

// First we'll create a method to get the most common for a position
// We could treat everything as numbers already, but it isn't really necessary yet

char GetMostCommon (int pIndex, List<string> pStringsToTest)
{
    int total = pStringsToTest.Count;
    int oneCount = 0;

    foreach (string s in pStringsToTest)
    {
        //zero if '0', one if '1'
        oneCount += s[pIndex] - '0';
    }

    //More than half are 1's?
    //Need to be careful of integer/2 rounding which gives false positives
    return 
        (oneCount == total - oneCount) ? 
            'X' :                                   //if EQUAL return X for error
            ((oneCount > total/2f) ? '1' : '0');    //otherwise decide
}

// Now we'll create gamma from the most common bits founds, assuming we'll never get X (or an exception will occur)

int charCount = numbersAsString[0].Length;
char[] gammaChars = new char[charCount];

for (int i = 0; i < charCount;i++)
{
    gammaChars[i] = GetMostCommon(i, numbersAsString);
}

string gammaString = new string(gammaChars);
Console.WriteLine("Gamma:    " + gammaString.PadLeft(charCount, '0'));

int gamma = Convert.ToInt32(gammaString, 2);

// And with gamma we can create epsilon, by taking the inverse, masked by the amount of bits required

int epsilon = ~gamma & (int)(Math.Pow(2, charCount) - 1);
Console.WriteLine("Epsilon:  " + Convert.ToString(epsilon, 2).PadLeft(charCount, '0'));

Console.WriteLine("Part 1 - Gamma * Epsilon: " + (gamma * epsilon));

// Part 2 - Basically the same as part 1 EXCEPT that after every count we need
// to reduce the list of strings we are testing:
// - 1 list containing only the values with the most common bit at position x
// - 1 list containing only the values with the least common bit at position x

// In other words gamma will no longer be the opposite from epsilon and every step the list reduces further.
//
// This is easily solved using some LINQ + Recursion:

// By default this filters on most common bit, but if you pass true for pLeastCommon it will flip the equation

string FindBinaryPattern (int pIndex, List<string> pStringsToTest, bool pLeastCommon)
{
    //First find the most common char at the given position for the given set
    char mostCommon = GetMostCommon(pIndex, pStringsToTest);

    //If X we need to check whether we are looking for the most or least common
    //By default X defaults to MOST COMMON 1 since we'll flip the test below automatically
    mostCommon = (mostCommon == 'X') ? '1' : mostCommon;

    //Then filter the given set on whether char[pIndex] is the most common (or flip it to look for the least common)
    List<string> newSet = pStringsToTest.Where (x => ((x[pIndex] == mostCommon ^ pLeastCommon))).ToList();

    if (newSet.Count == 1) return newSet[0];
    else return FindBinaryPattern(pIndex + 1, newSet, pLeastCommon);
}

int oxygen = Convert.ToInt32 (FindBinaryPattern(0, numbersAsString, false),2);
int co2 = Convert.ToInt32 (FindBinaryPattern(0, numbersAsString, true),2);

Console.WriteLine("Oxygen: " + oxygen);
Console.WriteLine("Co2: " + co2);

Console.WriteLine("Part 2 - Life support rating: " + (oxygen * co2));